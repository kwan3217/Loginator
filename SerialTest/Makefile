#Since the whole point of this project is to test the LPC4078, set the submodel here
SUBMDL=LPC4078
OPTLEVEL = 3
PROJECT_BRIEF="Serial port test, mostly only useful for LPC4078"
HWDESCCSV=Loginator2368Hardware.csv Loginator2368Onboard.csv
#include ../libraries/LPCduino/Makefile
include ../libraries/peripherals/Serial/Makefile
#include ../libraries/dump/Makefile
#include ../libraries/hardwareDesc/Makefile
include ../libraries/System/Makefile
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x000,local'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x01c,local'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x030,local'
ARM_SYMBOLS+=--add-symbol '&reset_cont=.bootrom:0x030'
ARM_SYMBOLS+=--add-symbol '~bit14=.bootrom:0x034'
ARM_SYMBOLS+=--add-symbol '&sysctl[3c0]=.bootrom:0x038'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x03C,local'
ARM_SYMBOLS+=--add-symbol 'reset_cont=.bootrom:0x03C'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x0b0,local'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x0e0,local'
ARM_SYMBOLS+=--add-symbol '&stack=.bootrom:0x000'
ARM_SYMBOLS+=--add-symbol '&reset=.bootrom:0x004'
ARM_SYMBOLS+=--add-symbol '&nmi=.bootrom:0x008'
ARM_SYMBOLS+=--add-symbol '&hardfault=.bootrom:0x00C'
ARM_SYMBOLS+=--add-symbol '&mmfault=.bootrom:0x010'
ARM_SYMBOLS+=--add-symbol '&busfault=.bootrom:0x014'
ARM_SYMBOLS+=--add-symbol '&usagefault=.bootrom:0x018'
ARM_SYMBOLS+=--add-symbol 'reset=.bootrom:0x01c'
ARM_SYMBOLS+=--add-symbol 'emulate_reset1=.bootrom:0x09e'
ARM_SYMBOLS+=--add-symbol 'emulate_reset2=.bootrom:0x0a6'
ARM_SYMBOLS+=--add-symbol '&scbcrp=.bootrom:0x0b0'
ARM_SYMBOLS+=--add-symbol '&boot[43c]=.bootrom:0x0b4'
ARM_SYMBOLS+=--add-symbol '&boot[5d0]=.bootrom:0x0b8'
ARM_SYMBOLS+=--add-symbol '&crp4=.bootrom:0x0bc'
ARM_SYMBOLS+=--add-symbol '&top_ram=.bootrom:0x0c0'
ARM_SYMBOLS+=--add-symbol '&reset2=.bootrom:0x0c4'
ARM_SYMBOLS+=--add-symbol '&usercrp=.bootrom:0x0c8'
ARM_SYMBOLS+=--add-symbol 'crp2=.bootrom:0x0cc'
ARM_SYMBOLS+=--add-symbol 'crp3=.bootrom:0x0d0'
ARM_SYMBOLS+=--add-symbol 'crp1=.bootrom:0x0d4'
ARM_SYMBOLS+=--add-symbol 'top_ram=.bootrom:0x0d8'
ARM_SYMBOLS+=--add-symbol 'crp4=.bootrom:0x0dc'
ARM_SYMBOLS+=--add-symbol 'nmi=.bootrom:0x0e0'
ARM_SYMBOLS+=--add-symbol 'hardfault=.bootrom:0x0e2'
ARM_SYMBOLS+=--add-symbol 'mmfault=.bootrom:0x0e4'
ARM_SYMBOLS+=--add-symbol 'busfault=.bootrom:0x0e6'
ARM_SYMBOLS+=--add-symbol 'usagefault=.bootrom:0x0e8'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x0f0,local'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x0f4,local'
ARM_SYMBOLS+=--add-symbol 'interpret_command=.bootrom:0x0f4'
ARM_SYMBOLS+=--add-symbol 'autobaud=.bootrom:0x1a2'
ARM_SYMBOLS+=--add-symbol 'isp_entry=.bootrom:0x2ec'
ARM_SYMBOLS+=--add-symbol 'pop_and_return=.bootrom:0x2ac'
ARM_SYMBOLS+=--add-symbol 'setup_clocks_and_peripherals=.bootrom:0x2b0'
ARM_SYMBOLS+=--add-symbol 'start_usercode_if_checksum_good=.bootrom:0x346'
ARM_SYMBOLS+=--add-symbol 'setup_emc_pins=.bootrom:0x388'
ARM_SYMBOLS+=--add-symbol 'setup_emc=.bootrom:0x3e6'
ARM_SYMBOLS+=--add-symbol 'usercode_entry=.bootrom:0x44c'
ARM_SYMBOLS+=--add-symbol 'reset2=.bootrom:0x46e'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x4f4,local'
ARM_SYMBOLS+=--add-symbol '&crp2=.bootrom:0x4f4'
ARM_SYMBOLS+=--add-symbol '&isp_ram_vars=.bootrom:0x4f8'
ARM_SYMBOLS+=--add-symbol '&crp3=.bootrom:0x4fc'
ARM_SYMBOLS+=--add-symbol '&parsetable=.bootrom:0x500'
ARM_SYMBOLS+=--add-symbol '&crp1=.bootrom:0x504'
ARM_SYMBOLS+=--add-symbol '&boot[430]=.bootrom:0x508'
ARM_SYMBOLS+=--add-symbol '&gpio=.bootrom:0x50C'
ARM_SYMBOLS+=--add-symbol '&timer1=.bootrom:0x510'
ARM_SYMBOLS+=--add-symbol '&pinconnect=.bootrom:0x514'
ARM_SYMBOLS+=--add-symbol '&Synchronized=.bootrom:0x518'
ARM_SYMBOLS+=--add-symbol '&sysctl[150]=.bootrom:0x51C'
ARM_SYMBOLS+=--add-symbol '&uart0=.bootrom:0x520'
ARM_SYMBOLS+=--add-symbol '&&usercrp=.bootrom:0x524'
ARM_SYMBOLS+=--add-symbol '&OK=.bootrom:0x528'
ARM_SYMBOLS+=--add-symbol '&boot[5b4]=.bootrom:0x52C'
ARM_SYMBOLS+=--add-symbol '&boot[458]=.bootrom:0x530'
ARM_SYMBOLS+=--add-symbol '&sysctl=.bootrom:0x534'
ARM_SYMBOLS+=--add-symbol '&boot[5b8]=.bootrom:0x538'
ARM_SYMBOLS+=--add-symbol '&boot[5f4]=.bootrom:0x53C'
ARM_SYMBOLS+=--add-symbol '&emc=.bootrom:0x540'
ARM_SYMBOLS+=--add-symbol '&boot[5d0]=.bootrom:0x544'
ARM_SYMBOLS+=--add-symbol 'crp4=.bootrom:0x548'
ARM_SYMBOLS+=--add-symbol '&adc=.bootrom:0x554'
ARM_SYMBOLS+=--add-symbol 'reset2_cont=.bootrom:0x558'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x558,local'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x5f4,local'
ARM_SYMBOLS+=--add-symbol '&boot[5b0]=.bootrom:0x5f4'
ARM_SYMBOLS+=--add-symbol '&boot[5b4]=.bootrom:0x5f8'
ARM_SYMBOLS+=--add-symbol '&boot[5bc]=.bootrom:0x5fc'
ARM_SYMBOLS+=--add-symbol '&boot[5e0]=.bootrom:0x600'
ARM_SYMBOLS+=--add-symbol '&boot[5e4]=.bootrom:0x604'
ARM_SYMBOLS+=--add-symbol '&boot[5f0]=.bootrom:0x608'
ARM_SYMBOLS+=--add-symbol '&boot[5e8]=.bootrom:0x60c'
ARM_SYMBOLS+=--add-symbol '&boot[5ec]=.bootrom:0x610'
ARM_SYMBOLS+=--add-symbol '&boot[5d4]=.bootrom:0x614'
ARM_SYMBOLS+=--add-symbol '&boot[5c8]=.bootrom:0x618'
ARM_SYMBOLS+=--add-symbol '&boot[5cc]=.bootrom:0x61C'
ARM_SYMBOLS+=--add-symbol 'bitmask=.bootrom:0x620'
ARM_SYMBOLS+=--add-symbol '&gpio=.bootrom:0x624'
ARM_SYMBOLS+=--add-symbol '&crp5=.bootrom:0x628'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x62C,local'
ARM_SYMBOLS+=--add-symbol 'routine062c=.bootrom:0x62c'
ARM_SYMBOLS+=--add-symbol 'routine0636=.bootrom:0x636'
ARM_SYMBOLS+=--add-symbol 'rounded_divide=.bootrom:0x782'
ARM_SYMBOLS+=--add-symbol 'handle_command_T=.bootrom:0x998'
ARM_SYMBOLS+=--add-symbol 'handle_command_M=.bootrom:0xa40'
ARM_SYMBOLS+=--add-symbol 'handle_command_I=.bootrom:0xab2'
ARM_SYMBOLS+=--add-symbol 'handle_command_E=.bootrom:0xb42'
ARM_SYMBOLS+=--add-symbol 'handle_command_C=.bootrom:0xc16'
ARM_SYMBOLS+=--add-symbol 'handle_command_P=.bootrom:0xcae'
ARM_SYMBOLS+=--add-symbol 'handle_command_A=.bootrom:0xcf8'
ARM_SYMBOLS+=--add-symbol 'handle_command_B=.bootrom:0xd28'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0xd98,local'
ARM_SYMBOLS+=--add-symbol '&parsetable=.bootrom:0xd98'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0xd9c,local'
ARM_SYMBOLS+=--add-symbol 'handle_command_U=.bootrom:0xdd2'
ARM_SYMBOLS+=--add-symbol 'handle_command_G=.bootrom:0xe0a'
ARM_SYMBOLS+=--add-symbol 'handle_command_R=.bootrom:0xe6c'
ARM_SYMBOLS+=--add-symbol 'handle_command_W=.bootrom:0xf38'
ARM_SYMBOLS+=--add-symbol 'dispatch_command=.bootrom:0x102c'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x115c,local'
ARM_SYMBOLS+=--add-symbol '&paramtable=.bootrom:0x115c'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x1160,local'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x1180,local'
ARM_SYMBOLS+=--add-symbol '&boot[430]=.bootrom:0x1180'
ARM_SYMBOLS+=--add-symbol '&boot[5dc]=.bootrom:0x1184'
ARM_SYMBOLS+=--add-symbol '&boot[434]=.bootrom:0x1188'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x118c,local'
ARM_SYMBOLS+=--add-symbol 'set_baud=.bootrom:0x118c'
ARM_SYMBOLS+=--add-symbol 'write_char=.bootrom:0x11ca'
ARM_SYMBOLS+=--add-symbol 'read_and_echo=.bootrom:0x11d6'
ARM_SYMBOLS+=--add-symbol 'wait_for_ctrl_q=.bootrom:0x11f4'
ARM_SYMBOLS+=--add-symbol 'write_str=.bootrom:0x1200'
ARM_SYMBOLS+=--add-symbol 'has_read=.bootrom:0x1244'
ARM_SYMBOLS+=--add-symbol 'mirror_delay=.bootrom:0x1256'
ARM_SYMBOLS+=--add-symbol 'read_str=.bootrom:0x1266'
ARM_SYMBOLS+=--add-symbol 'set_echo=.bootrom:0x12b0'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x12b8,local'
ARM_SYMBOLS+=--add-symbol '&uart0=.bootrom:0x12b8'
ARM_SYMBOLS+=--add-symbol '&echo=.bootrom:0x12bc'
ARM_SYMBOLS+=--add-symbol '&timer1=.bootrom:0x12c0'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x12c4,local'
ARM_SYMBOLS+=--add-symbol 'strcmp=.bootrom:0x12c4'
ARM_SYMBOLS+=--add-symbol 'parse_cmd_params=.bootrom:0x12e2'
ARM_SYMBOLS+=--add-symbol 'string_to_uint32=.bootrom:0x134e'
ARM_SYMBOLS+=--add-symbol 'uint32_to_string=.bootrom:0x137e'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x1630,local'
ARM_SYMBOLS+=--add-symbol 'Synchronized=.bootrom:0x1630'
ARM_SYMBOLS+=--add-symbol 'OK=.bootrom:0x1654'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x1684,local'
ARM_SYMBOLS+=--add-symbol 'delay=.bootrom:0x16da'
ARM_SYMBOLS+=--add-symbol 'lock_bootblock=.bootrom:0x16ee'
ARM_SYMBOLS+=--add-symbol 'unlock_bootblock=.bootrom:0x16fe'
ARM_SYMBOLS+=--add-symbol 'routine170e=.bootrom:0x170e'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x1784,local'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x17a0,local'
ARM_SYMBOLS+=--add-symbol '$$d=.bootrom:0x1c7c,local'
ARM_SYMBOLS+=--add-symbol '$$t=.bootrom:0x1c80,local'
ARM_SYMBOLS+=--add-symbol 'real_iap=.bootrom:0x17a0'
ARM_SYMBOLS+=--add-symbol 'IAP_LOCATION=.bootrom:0x1ff0'
ARM_SYMBOLS+=--add-symbol 'fosc_khz=.ram_memory:0x118'
ARM_SYMBOLS+=--add-symbol 'ram_usercrp=.ram_memory:0x120'
ARM_SYMBOLS+=--add-symbol 'echo=.ram_memory:0x124'
ARM_SYMBOLS+=--add-symbol 'inbuf=.ram_memory:0x128'
ARM_SYMBOLS+=--add-symbol 'param0=.ram_memory:0x16e'
ARM_SYMBOLS+=--add-symbol 'param1=.ram_memory:0x17d'
ARM_SYMBOLS+=--add-symbol 'param2=.ram_memory:0x18c'
ARM_SYMBOLS+=--add-symbol 'param3=.ram_memory:0x19b'
ARM_SYMBOLS+=--add-symbol 'param4=.ram_memory:0x1aa'
ARM_SYMBOLS+=--add-symbol 'parsetable=.ram_memory:0x1bc'

bootstrap.o: bootstrap.hex Makefile bss.bin
	arm-none-eabi-objcopy $< -O elf32-little -B arm --add-section .ram_memory=bss.bin --rename-section .sec1=.bootrom --set-section-flags .sec1=alloc,contents,load,code,rom $(ARM_SYMBOLS) --change-section-address .ram_memory=0x10000000 $@

bss.bin:
	dd if=/dev/zero of=bss.bin bs=1024 count=64

bootstrap.disasm: bootstrap.o Makefile notes.txt ../DumpIap/asm_note.pl
	cp $@ notes.txt
	arm-none-eabi-objdump -d -marm -z $< | perl ../DumpIap/asm_note.pl notes.txt > $@

mbed_blinky.disasm: mbed_blinky.elf Makefile notes.txt ../DumpIap/asm_note.pl
	cp $@ notes.txt
	arm-none-eabi-objdump -d -marm -z $< | perl ../DumpIap/asm_note.pl notes.txt > $@

bootstrap.trace: bootstrap.disasm
	java -classpath ../../../build/ org.kwansystems.emulator.arm.Emulator > $@
